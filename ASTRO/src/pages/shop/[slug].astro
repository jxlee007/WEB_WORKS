---
import Layout from "../../layouts/Layout.astro";
import Nav from "../../components/Nav.astro";
import Footer from "../../components/Footer.astro";
import { products } from "./products.js";

export async function getStaticPaths() {
	return products.map((p) => ({
		params: { slug: p.slug },
		props: { product: p }
	}));
}

const { product } = Astro.props;
---

<Layout title={product.title}>
    <Nav logo="/images/digisign/ds1-black.png" />
    <main class="px-4 sm:px-8 py-8 ">
        <!-- Hero banner (use product.layout.hero if available) -->
        <section class="mt-6">
            <div class="relative max-w-6xl mx-auto overflow-hidden">
                <img src={product.layout && product.layout.hero ? product.layout.hero : product.image} alt={product.title} class="w-full h-80 sm:h-96 lg:h-[420px] object-cover brightness-90" />
                <div class="absolute inset-0 flex items-center">
                    <div class="px-6 sm:px-12">
                        {product.layout && product.title ? (
                            product.title.split('\n').map((line, idx) => (
                                <h1 class={`text-white font-medium line-clamp-2 ${idx === 0 ? 'text-6xl sm:text-7xl md:text-8xl' : 'mt-2 text-6xl sm:text-7xl md:text-8xl'} leading-none tracking-tight`}>{line.toUpperCase()}</h1>
                            ))
                        ) : (
                            <h1 class="text-white font-medium line-clamp-2 text-6xl sm:text-7xl md:text-8xl leading-none tracking-tight">{product.title.toUpperCase()}</h1>
                        )}
                    {product.subtitle ? (
                        <div class="ml-2">
                            <p class="text-white/90 mt-4 text-lg sm:text-xl max-w-2xl uppercase ">{product.subtitle}</p>
                        </div>
                    ) : null}
                    </div>
                </div>
            </div>
        </section>

        <!-- Products row rendered from product.layout.products if present -->
        {product.layout && product.layout.products ? (
            <section class="mt-8">
                <div class="max-w-6xl mx-auto">
                    {(() => {
                        const productsList = product.layout.products || [];
                        const count = productsList.length;
                            const cols = Math.min(Math.max(count, 1), 4);
                            // Responsive grid: 1 on xs, 2 on sm, up to `cols` on md (tablet/laptop) and same on lg
                            const responsiveColsClass = `grid-cols-2 sm:grid-cols-3 md:grid-cols-4`;
                        return (
                            <div 
                            class={`grid gap-4 items-start justify-center ${responsiveColsClass}`}
                                        >
                                {productsList.map((item, i) => (
                                    <article class="text-center">
                                        <div class="w-full flex justify-center">
                                                <div class="w-full max-w-xs sm:max-w-sm md:max-w-md sm:h-64 md:h-72 lg:h-80 bg flex items-center justify-center overflow-hidden rounded">
                                                    <img src={encodeURI(item.image)} alt={item.title} class="w-full h-full object-cover" />
                                                </div>
                                            </div>

                                            <h3 class="text-md text-gray-700 mt-3">{item.title}</h3>
                                    </article>
                                ))}
                            </div>
                        );
                    })()}
                </div>
            </section>
        ) : (
            <!-- fallback: simple generic listing -->
            <section class="mt-12">
                <div class="max-w-7xl mx-auto">
                    <div class="prose">
                        <h2>{product.title}</h2>
                        <p>{product.subtitle}</p>
                    </div>
                </div>
            </section>
        )}
    </main>

    <Footer />
</Layout>

